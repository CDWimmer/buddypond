<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge" />
<meta name="description" content="Buddy Pond - A place for buddies to chat." />
<title>Buddy Pond</title>
<!--[if lt IE 7]>
<script>
window.top.location = 'ie.html';
</script>
<![endif]-->
<link rel="stylesheet" href="assets/css/reset.css" />
<link rel="stylesheet" href="assets/css/desktop.css" />

<!--[if lt IE 9]>
<link rel="stylesheet" href="assets/css/ie.css" />
<![endif]-->
</head>
<body>
<div class="abs" id="wrapper">
  <div class="abs" id="desktop">
    <a class="abs icon" style="left:20px;top:40px;" href="#icon_dock_buddylist">
      <img src="assets/images/icons/icon_32_network.png" />
      Buddy List
    </a>
    <a class="abs icon" style="left:20px;top:120px;" href="#icon_dock_console">
      <img src="assets/images/icons/icon_32_computer.png" />
      Console
    </a>
    <a id="login_desktop_icon" class="abs icon" style="left:110px;top:40px;" href="#icon_dock_login">
      <img src="assets/images/icons/icon_32_drive.png" />
      Login
    </a>
    
       <!--
       <a class="abs icon" style="left:20px;top:180px;" href="#icon_dock_disc">
         <img src="assets/images/icons/icon_32_disc.png" />
         Audio CD
       </a>
       <a class="abs icon" style="left:20px;top:260px;" href="#icon_dock_network">
         <img src="assets/images/icons/icon_32_network.png" />
         Network
       </a>
         -->

    <div id="window_login" class="abs window">
      <div class="abs window_inner">
        <div class="window_top">
          <span class="float_left">
            <img src="assets/images/icons/icon_16_computer.png" />
            Login
          </span>
          <span class="float_right">
            <a href="#" class="window_min"></a>
            <a href="#" class="window_resize"></a>
            <a href="#icon_dock_login" class="window_close"></a>
          </span>
        </div>
        <div class="abs window_content">
          <div class="window_main">
            <div class="splash">
              <h1>Welcome to Buddy Pond!</h1>
              <em>Peer to Peer Buddy Messaging</em>
              <br/>
              <em>Unencrypted messages and chat rooms</em>
              <br/>
              <em>We don't' store your data</em>
              <br/>
              <em>No followers or following counts, just Buddies</em>
              <div class="splashImage">
                <img src="assets/images/pond.jpeg" width="144" height="144" title="Buddy in a pond"/>
                <br/>
                <em class="smaller">This is a Buddy at the pond.</em>
              </div>
              <br/>
              <div class="loginForm">
                <form method="POST" action="/login">
                  <table>
                    <tr>
                      <td><label for="buddyname">Buddy Name:</label></td>
                      <td><input id="buddyname" name="buddyname" type="text" size="16"/></td>
                    </tr>
                    <tr>
                      <td><label for="buddypassword">Buddy Password:</label></td>
                      <td><input id="buddypassword" name="buddypassword" type="password" size="16"/></td>
                    </tr>
                  </table>
                   <br/>
                   <button type="submit" class="loginButton desktopButton">Login</button>
                </form>
              </div>
              <br/>
               <ul>
                 <li>New Users just pick a name and password</li>
                 <li>The login is the password</li>
                 <li>There is no registration process</li>
               </ul>
            </div>
          </div>
        </div>
        <div class="abs window_bottom">
          Build: v4.20.69
        </div>
      </div>
      <span class="abs ui-resizable-handle ui-resizable-se"></span>
    </div>
    <div id="window_console" class="abs window">
      <div class="abs window_inner">
        <div class="window_top">
          <span class="float_left">
            <img src="assets/images/icons/icon_16_computer.png" />
            Console
          </span>
          <span class="float_right">
            <a href="#" class="window_min"></a>
            <a href="#" class="window_resize"></a>
            <a href="#icon_dock_console" class="window_close"></a>
          </span>
        </div>
        <div class="abs window_content">
          <div class="window_main">
            <ul class="console">
            </ul>
          </div>
        </div>
        <div class="abs window_bottom">
          Build: v4.20.69
        </div>
      </div>
      <span class="abs ui-resizable-handle ui-resizable-se"></span>
    </div>

    <div id="window_buddylist" class="abs window">
      <div class="abs window_inner">
        <div class="window_top">
          <span class="float_left">
            <img src="assets/images/icons/icon_16_computer.png" />
            Buddy List
          </span>
          <span class="float_right">
            <a href="#" class="window_min"></a>
            <a href="#" class="window_resize"></a>
            <a href="#icon_dock_buddylist" class="window_close"></a>
          </span>
        </div>
        <div class="abs window_content">
          <div class="window_main">
            <div class="buddy_list_not_connected">
              You'll need to login in order to access your Buddy List.
            </div>
            <div class="buddyListHolder">
              <div align="center">Hello. You look nice today!</div>
              <br/>
              <h2>Buddies</h2>
              <span class="you_have_no_buddies">
                You don't have buddies yet!<br/><br/>
                You can always add yer buddy:<br/><br/>
                <a href="#/addbuddy/Marak" class="sendBuddyRequest">Marak</a> <- Click Here To Add
              </span>
              <ul class="buddylist">
              </ul>
              <br/>
              <div class="pendingIncomingBuddyRequestsHolder">
                <h3>New Buddy Requests</h3>
                <div class="pendingIncomingBuddyRequests">
                </div>
                <br/>
              </div>
              <div class="pendingOutgoingBuddyRequestsHolder">
                <h3>Pending Buddy Requests</h3>
                <div class="pendingOutgoingBuddyRequests">
                </div>
                <br/>
                <br/>
              </div>
              <div class="addBuddyForm">
                <form method="POST" action="#">
                  <label for="buddy_request_name">Add Buddy:</label><br/>
                  <input id="buddy_request_name" value="Marak" class="buddy_request_name" name="buddy_request_name" type="text" size="16"/><br/>
                  <button class="sendBuddyRequest desktopButton" type="submit">Send Buddy Request</button>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div class="abs window_bottom">
          Build: v4.20.69
        </div>
      </div>
      <span class="abs ui-resizable-handle ui-resizable-se"></span>
    </div>

    <div id="window_buddy_message_0" class="abs window buddy_message" data-window-index="0">
      <div class="abs window_inner">
        <div class="window_top">
          <span class="float_left">
            <img src="assets/images/icons/icon_16_computer.png" />
            <span class="window-context-title">Chat</span>
          </span>
          <span class="float_right">
            <a href="#" class="window_min"></a>
            <a href="#" class="window_resize"></a>
            <a href="#icon_dock_buddy_message_0" class="window_close"></a>
          </span>
        </div>
        <div class="abs window_content">
          <div class="window_main">
            <div class="chatMessagesHolder">
              <div class="no_chat_messages">
                Your conversation has just started. You can send a message to your buddy below.
              </div>
              <div class="chat_messages">
              </div>
              <hr/>
              <div class="chat_send_message_form">
                <form method="POST" action="">
                  <textarea name="buddy_message_text" class="buddy_message_text" rows="4" cols="44"></textarea>
                  <input name="buddy_message_from"  class="buddy_message_from" type="hidden"/>
                  <input name="buddy_message_to"  class="buddy_message_to" type="hidden"/><br/>
                  <button class="sendBuddyMessage desktopButton" type="submit">Send Message</button>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div class="abs window_bottom">
          Build: v4.20.69
        </div>
      </div>
      <span class="abs ui-resizable-handle ui-resizable-se"></span>
    </div>

  </div>
  <div class="abs" id="bar_top">
    <span class="me_title" id="me_title">Welcome</span>
    <span class="float_right" id="clock"></span>
    <ul class="float_right">
      <li>
        <a class="menu_trigger" href="#">Buddy Pond</a>
        <ul class="menu">
          <li>
            <a href="http://github.com/marak/buddypond-client">Source Code</a>
          </li>
          <li>
            <a href="http://github.com/marak">Home Page</a>
          </li>
        </ul>
      </li>
    </ul>
    <!--
    <span class="float_right"><img height="16" width="16" src="assets/images/animations/pixel-animator.gif"/></span>
    <span class="float_right"><img height="16" width="16" src="assets/images/animations/pixel-animator.gif"/></span>
    <span class="float_right"><img height="16" width="16" src="assets/images/animations/pixel-animator.gif"/></span>
    <span class="float_right"><img height="16" width="16" src="assets/images/animations/pixel-animator.gif"/></span>
    -->
  </div>
  <div class="abs" id="bar_bottom">
    <a class="float_left" href="#" id="show_desktop" title="Show Desktop">
      <img src="assets/images/icons/icon_22_desktop.png" />
    </a>
    <ul id="dock">
      <li id="icon_dock_computer">
        <a href="#window_computer">
          <img src="assets/images/icons/icon_22_computer.png" />
          Computer
        </a>
      </li>
      <li id="icon_dock_login">
        <a href="#window_login">
          <img src="assets/images/icons/icon_22_drive.png" />
          Login
        </a>
      </li>
      <li id="icon_dock_console">
        <a href="#window_console">
          <img src="assets/images/icons/icon_22_disc.png" />
          Console
        </a>
      </li>
      <li id="icon_dock_buddylist">
        <a href="#window_buddylist">
          <img src="assets/images/icons/icon_22_disc.png" />
          Buddy List
        </a>
      </li>
      <li id="icon_dock_buddy_message_0">
        <a href="#window_buddy_message_0">
          <img src="assets/images/icons/icon_22_network.png" />
          <span class="dock_title">
            Chat with X
          </span>
        </a>
      </li>
    </ul>
  </div>
</div>
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/jquery-ui.min.js"></script>
<script>
  !window.jQuery && document.write(unescape('%3Cscript src="assets/js/jquery.js"%3E%3C/script%3E'));
  !window.jQuery && document.write(unescape('%3Cscript src="assets/js/jquery.ui.js"%3E%3C/script%3E'));
</script>
<script src="assets/js/jquery.desktop.js"></script>
<script src="buddypond.js"></script>
<script src="desktop.js"></script>

<script>
  $(document).ready(function(){

    // clone window_buddy_message_0 ten times
    // clone icon_dock_buddy_message_0 ten times 
    // this creates 10 windows available for chatting with buddies
    let clone = $('#window_buddy_message_0').html();
    let dockItemClone = $('#icon_dock_buddy_message_0').html();

    for (let i = 1; i<11; i++) {
      let buddyChatStr = '<div id="window_buddy_message_' + i +'" class="abs window buddy_message" data-window-index="' + i + '">' + clone.replace('icon_dock_buddy_message_0', 'icon_dock_buddy_message_' + i) + '</div>'
      $('#desktop').append(buddyChatStr);
      let dockStr = dockItemClone.replace('window_buddy_message_0', 'window_buddy_message_' + i)
      dockStr = '<li id="icon_dock_buddy_message_' + i +'">' + dockStr + '</li>'
      $('#desktop').append(buddyChatStr);
      $('#dock').append(dockStr);
    }

    desktop.load();
    desktop.refresh();

    $('#window_login').css('width', 800)
    $('#window_login').css('height', 400)
    
    $('#window_login').show();
    $('#window_login').css('left', 222)
    $('#window_login').css('top', 111)

    // $('#window_console').show();

    desktop.renderDockElement('login');
    // desktop.renderDockElement('console');

    /*
    $( "#window_console" ).position({
      my: "left top",
      at: "right top",
      of: "#window_login"
    });
    */

    $('#buddyname').focus();
    $('form').on('submit', function(){
      return false;
    });

    $('.loginButton').on('click', function(){
      let buddyname = $('#buddyname').val();
      desktop.log('buddypond.authBuddy ->', buddyname);
      buddypond.authBuddy(buddyname, $('#buddypassword').val(), function(err, data){
        console.log("Buddy pond api returns");
        $('#me_title').html('Welcome - ' + buddyname);
        desktop.log('buddypond.authBuddy <-', data);
        $('.console').val()
        $('.qtokenid').val(data);
        if (data === false) {
          // TODO: alert UI, try again
        } else {
          buddypond.qtokenid = data;
          $('#window_login').hide();
          $('#login_desktop_icon').hide();
          $('#logout_desktop_icon').show();
          $('#window_buddylist').show();
          $('#window_buddylist').css('width', 220)
          $('#window_buddylist').css('height', 440)
          $('#window_buddylist').css('left', 666)
          $('#window_buddylist').css('top', 111)
          desktop.renderDockElement('buddylist');
          desktop.removeDockElement('login')
        }
        console.log(err, data)
      });
    });
  });
</script>

</body>
</html>